tinymce.PluginManager.add('quiz', function (editor, url) {
        // Add a button that opens a window
        editor.addButton('quiz', {
            text: '? Insert Question',
            tooltip: 'To place instructions or other text above or below your test question, just insert your cursor where you want the text and type your instructions. You can also add a document, video, or image.',
            icon: false,
            onclick: function () {
    //            console.log(url+'/dialog.html');
//                $html = questionsModal();
//                $a = jQuery.parseHTML($html);
//                setup();
//                jQuery($a).modal();
                
                openQuestionDialog(editor, null);
    //            jQuery('#save_mcqs').click(function(){
    //                var content =  tinymce.get('question_statement').getContent();
    //                console.log(content);
    //            })
            }
        });

    });
jQuery(window).load(function(){
    attachEditButtonClickEvent();
    jQuery('#QuestionModal').on('hidden.bs.modal', function () {
        removeCurrectClassForm();
    });
});
//setup();
function setup(){
    tinymce.init({
        setup:function(ed) {
           ed.on('change', function(e) {
    //           console.log('the event object ', e);
    //           console.log('the editor object ', ed);
    //           console.log('the content ', ed.getContent());
           });
       },
        language: pcr_ml_obj.tinymce_lang,
        selector: "#question_statement, #answer_1, #answer_2, #answer_3, #answer_4, #answer_5, #answer_selection_1, #answer_selection_2, #answer_selection_3, #answer_selection_4, #answer_selection_5, #truefalse_question_statement, #truefalse_answer_selection_1, #truefalse_answer_selection_2",
        menubar: false,
        theme: "modern",
        height: '300',
        width: '99.5%',
        subfolder: "",
        enableLodeStar: trusted,
        relative_urls: false,
        statusbar: false,
        plugins: [
            /*gdocsviewer video*/
            "fileuploaderquestions"
        ],
        content_css: [
            'https://www.curriki.org/wp-content/themes/genesis-curriki/curriki-customized/css/curriki-custom-style-alpha.css?ver=4.3.1',
            'https://www.curriki.org/wp-content/themes/genesis-curriki/curriki-customized/css/jquery.tooltip.css?ver=4.3.1',
            'https://www.curriki.org/wp-content/plugins/genesis-connect-for-buddypress/css/buddypress.css?ver=4.3.1',
            'https://www.curriki.org/wp-content/plugins/bbpress/templates/default/css/bbpress.css?ver=2.5.8-5815',
            'https://www.curriki.org/wp-content/plugins/buddypress/bp-activity/css/mentions.min.css?ver=2.3.4',
            'https://www.curriki.org/wp-content/themes/genesis-curriki/css/misc.css?ver=4.3.1',
            'https://www.curriki.org/wp-content/plugins/tablepress/css/default.min.css?ver=1.6.1',
            'https://www.curriki.org/wp-content/themes/genesis-curriki/css/font-awesome.min.css?ver=4.3.0',
            'https://www.curriki.org/wp-content/themes/genesis-curriki/style.css?ver=4.3.1',
            'https://www.curriki.org/wp-content/plugins/jetpack/_inc/genericons/genericons/genericons.css?ver=3.1',
            'https://www.curriki.org/wp-content/plugins/jetpack/css/jetpack.css?ver=3.7.2',
            'https://www.curriki.org/wp-content/themes/genesis-curriki/js/fancytree/src/skin-win7/ui.fancytree.css',
            'https://www.curriki.org/wp-content/themes/genesis-curriki/js/fancytree/lib/prettify.css',
//            'https://www.curriki.org/wp-content/plugins/addthis/css/output.css?ver=4.3.1',
            'https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css?ver=4.3.1',
            'https://www.curriki.org/wp-content/themes/genesis-curriki/css/legacy.css?ver=4.3.1',
            'https://www.curriki.org/wp-content/themes/genesis-curriki/js/fancybox_v2.1.5/jquery.fancybox.css?v=2.1.5&ver=4.3.1',
            'https://www.curriki.org/wp-content/themes/genesis-curriki/js/qtip2_v2.2.1/jquery.qtip.min.css?ver=4.3.1',
            'https://www.curriki.org/wp-content/themes/genesis-curriki/js/oer-custom-script/oer-custom-style.css?ver=4.3.1',
            'https://www.curriki.org/wp-content/themes/genesis-curriki/css/curriki-custom-style.css?ver=4.3.1',
            'https://www.curriki.org/wp-content/themes/genesis-curriki/css/legacy.css?ver=4.3.1',
            'https://www.curriki.org/wp-content/themes/genesis-curriki/css/questions_tinymce.css?ver=4.3.1',
        ],
        toolbar1: "oembed image video gdoc lodestar"
    });

    
}

var question_num = 0;

function openQuestionDialog(editor, data){
    jQuery('.questions-tabs .ui-tabs-nav').css("display", "block");
    jQuery('input[type=submit]').prop('disabled', false);
    // default values
    tinymce.get('question_statement').setContent("");
        
    tinymce.get('answer_1').setContent("");
    tinymce.get('answer_selection_1').setContent("");


    tinymce.get('answer_2').setContent("");
    tinymce.get('answer_selection_2').setContent("");


    tinymce.get('answer_3').setContent("");
    tinymce.get('answer_selection_3').setContent("");


    tinymce.get('answer_4').setContent("");
    tinymce.get('answer_selection_4').setContent("");

    tinymce.get('answer_5').setContent("");
    tinymce.get('answer_selection_5').setContent("");
    
    jQuery('[name=correct_answer]').removeAttr('checked'); 
    tinymce.get('truefalse_question_statement').setContent("");

    tinymce.get('truefalse_answer_selection_1').setContent("");

    tinymce.get('truefalse_answer_selection_2').setContent("");
    
    jQuery('[name=truefalse_correct_answer]').removeAttr('checked');
    
    jQuery("#QuestionModal").modal("show");

    insertMCQsContentIntoEditor(editor, data);
    insertTrueFalseContentIntoEditor(editor, data);
}
function openEditQuestionDialog(editor, data, $old_contents, question_front_form){
    jQuery('input[type=submit]').prop('disabled', false);
    var $old_html = jQuery('<div />',{html:$old_contents});
    /* Populating vaues into modal */
    if(data.question_type == 'mcq' ){
        
        tinymce.get('question_statement').setContent(data.question_statement);
        
        tinymce.get('answer_1').setContent(data.option1);
        tinymce.get('answer_selection_1').setContent(data.response_option1);
        
        
        tinymce.get('answer_2').setContent(data.option2);
        tinymce.get('answer_selection_2').setContent(data.response_option2);

        
        tinymce.get('answer_3').setContent(data.option3);
        tinymce.get('answer_selection_3').setContent(data.response_option3);

        
        tinymce.get('answer_4').setContent(data.option4);
        tinymce.get('answer_selection_4').setContent(data.response_option4);
        
        tinymce.get('answer_5').setContent(data.option5);
        tinymce.get('answer_selection_5').setContent(data.response_option5);
        if(data.correct_option != ''){
            jQuery('[name=correct_answer][value='+data.correct_option+']').prop("checked",true);
        }

    } else if(data.question_type == 'true_false'){
        

        tinymce.get('truefalse_question_statement').setContent(data.truefalse_question_statement);

        tinymce.get('truefalse_answer_selection_1').setContent(data.truefalse_answer_selection_1);

        tinymce.get('truefalse_answer_selection_2').setContent(data.truefalse_answer_selection_2);
        if(data.truefalse_correct_answer != ''){
            jQuery('[name=truefalse_correct_answer][value='+data.truefalse_correct_answer+']').prop("checked",true);
        }
        
    }
    
    
    
    
    jQuery("#QuestionModal").modal("show");
    
    insertMCQsContentIntoEditor(editor, data);
    insertTrueFalseContentIntoEditor(editor, data);

    console.log(data.question_type);
    
    if(data.question_type == 'mcq'){
        jQuery('.questions-tabs .ui-tabs-nav').css("display", "none");
//        jQuery('.questions-tabs').tabs('option', 'active', 0);
//        jQuery('[href=#true-false]').parent().hide();
    } else if(data.question_type == 'true_false') {
        jQuery('.questions-tabs .ui-tabs-nav').css("display", "none");
//        jQuery('.questions-tabs').tabs('option', 'active', 1);
//        jQuery('[href=#mcqs]').parent().hide();
    }
}
function insertMCQsContentIntoEditor(editor){
    jQuery('#mcq_question_form').off("submit").on("submit", function (e) {
        jQuery('input[type=submit]').prop('disabled', true);
        e.preventDefault();
        var question_form_this =jQuery(this);
        
        
        var submit = validateMCQQuestionEditor(question_form_this);
        if(submit == false){
            jQuery('input[type=submit]').prop('disabled', false);
            return submit;
        }

        // finding correct in case of empty

        var correct = jQuery('input[name=correct_answer]:checked').val();
        var empty = 0;
        for (var i = 1; i <= correct; i++){
            if(jQuery('#answer_'+i).val() == ''){
                empty++;
            }
        }
        correct -= empty;

        // question type handle
        var question_type = jQuery('[name=question_type]').val();



        question_num++;
        $html = '';
        $html += '<div class="question_wrapper">';
            $html += '<form class="question_front_form mceNonEditable">';
                $html += '<input type="hidden" name="question_num" value="'+question_num+'">';
                $html += '<div class="question_frontend_statement">';
                    $html += '<div class="question_title">';
                        $html += '<div class="question">';
                            $html += tinymce.get('question_statement').getContent();
                        $html += '</div>';
                        $html += '<span class="display_none edit_question_link" style="text-decoration:underline;cursor:pointer;">';
                        $html += 'Edit';
                        $html += '</span>';
                    $html += '</div>';
                $html += '</div>';
                $html += '<div class="question_frontend_options">';
                    $html += '<div class="frontend_option">';
                        $html += '<div class="frontend-label">';
                            $html += '<input type="radio" name="option" value="1" id="option1" />';
                                $html += '<div class="option_val">'+tinymce.get('answer_1').getContent()+'</div>';
                                $html += '<div class="clearfix"></div>';
                        $html += '</div>';
                        $html += '<div id="response_option1" style="display:none;" class="frontend_response">';
                            $html += tinymce.get('answer_selection_1').getContent();
                        $html += '</div>'
                    $html += '</div>';
                    ;
                    $html += '<div class="frontend_option">';
                        $html += '<div class="frontend-label">';
                            $html += '<input type="radio" name="option" value="2" id="option2" />';
                            $html += '<div class="option_val">'+tinymce.get('answer_2').getContent()+'</div>';
                            $html += '<div class="clearfix"></div>';
                        $html += '</div>';
                        $html += '<div id="response_option2" style="display:none;" class="frontend_response">';
                            $html += tinymce.get('answer_selection_2').getContent();
                        $html += '</div>';
                    $html += '</div>';
                    
                    if(jQuery('#answer_3').val() != '' && jQuery('#answer_3').length != 0){
                        $html += '<div class="frontend_option">';
                            $html += '<div class="frontend-label">';
                                $html += '<input type="radio" name="option" value="3" id="option3" />';
                                $html += '<div class="option_val">'+tinymce.get('answer_3').getContent()+'</div>';
                                $html += '<div class="clearfix"></div>';
                            $html += '</div>';
                            $html += '<div id="response_option3" style="display:none;" class="frontend_response">';
                                $html += tinymce.get('answer_selection_3').getContent();
                            $html += '</div>';
                        $html += '</div>';
                        
                    }

                    if(jQuery('#answer_4').val() != '' && jQuery('#answer_4').length != 0){
                        $html += '<div class="frontend_option">';
                            $html += '<div class="frontend-label">';
                                $html += '<input type="radio" name="option" value="4" id="option4" />';
                                $html += '<div class="option_val">'+tinymce.get('answer_4').getContent()+'</div>';
                                $html += '<div class="clearfix"></div>';
                            $html += '</div>';
                            $html += '<div id="response_option4" style="display:none;" class="frontend_response">';
                                $html += tinymce.get('answer_selection_4').getContent();
                            $html += '</div>';
                        $html += '</div>';
                        
                    }

                    if(jQuery('#answer_5').val() != '' && jQuery('#answer_5').length != 0){
                        $html += '<div class="frontend_option">';
                            $html += '<div class="frontend-label">';
                                $html += '<input type="radio" name="option" value="5" id="option5" />';
                                $html += '<div class="option_val">'+tinymce.get('answer_5').getContent()+'</div>';
                                $html += '<div class="clearfix"></div>';
                            $html += '</div>';
                            $html += '<div id="response_option5" style="display:none;" class="frontend_response">';
                                $html += tinymce.get('answer_selection_5').getContent();
                            $html += '</div>';
                        $html += '</div>';
                        
                    }

                $html += '</div>';
                $html += '<div class="correct_option" style="display:none;">';
                    $html += correct;
                $html += '</div>';
                $html += '<div class="question_type" style="display:none;">';
                    $html += question_type;
                $html += '</div>';
                $html += '<input type="hidden" class="questionid" name="questionid" value="'+jQuery('.questionid_form').val()+'" />';
                $html += '<div class="question_frontend_submit_wrapper">';
                    $html += '<input type="submit" name="question_frontend_submit" value="Check Answer">';
                $html += '</div>';
            $html += '</form>';    
        $html += '</div>';
        $html += '<p>&nbsp;</p>';
        if(jQuery("#questions").length == 0) {
            jQuery('<input>').attr({
                type: 'hidden',
                id: 'questions',
                name: 'questions[]'
            }).appendTo('#create_resource_form');
        }
        var $q = [];
        var $a = {};
        var prev_questions_obj = [];
        if(jQuery('#questions').val() != ""){
            var prev_questions = jQuery('#questions').val();
            prev_questions_obj = JSON.parse(prev_questions);
            prev_questions_obj.forEach(function(item, index){
                $q.push(item);
            });
        }
//        $q.push(prev_questions_obj);
        $a.question_statement = jQuery('#question_statement').val();
        $a.answer_1 = jQuery('#answer_1').val();
        $a.answer_2 = jQuery('#answer_2').val();
        $a.answer_3 = jQuery('#answer_3').val();
        $a.answer_4 = jQuery('#answer_4').val();
        $a.answer_5 = jQuery('#answer_5').val();
        $a.answer_selection_1 = jQuery('#answer_selection_1').val();
        $a.answer_selection_2 = jQuery('#answer_selection_2').val();
        $a.answer_selection_3 = jQuery('#answer_selection_3').val();
        $a.answer_selection_4 = jQuery('#answer_selection_4').val();
        $a.answer_selection_5 = jQuery('#answer_selection_5').val();
        $a.correct_answer = jQuery('input[name=correct_answer]:checked').val();
        $a.questionid_form = jQuery('.questionid_form').val();

        $q.push($a);

        jQuery('#questions').val(JSON.stringify($q));
        editor.insertContent($html);

        attachEditButtonClickEvent();
        jQuery("#QuestionModal").modal("hide");
    });
}

function insertTrueFalseContentIntoEditor(editor){
    var question_num = 0;
    jQuery('#truefalse_question_form').off("submit").on("submit", function (e) {
        e.preventDefault();
        var question_form_this =jQuery(this);
        
        
        var submit = validateTrueFalseQuestionEditor(question_form_this);
        if(submit == false){
            jQuery('input[type=submit]').prop('disabled', false);
            return submit;
        }

        // finding correct in case of empty

        var correct = jQuery('input[name=truefalse_correct_answer]:checked').val();
        var empty = 0;
        for (var i = 1; i <= correct; i++){
            if(jQuery('#answer_'+i).val() == ''){
                empty++;
            }
        }
        correct -= empty;

        // question type handle
        var question_type = jQuery('[name=truefalse_question_type]').val();



        question_num++;
        $html = '';
        $html = '<div class="question_wrapper">';
            $html += '<form class="question_front_form mceNonEditable">';
                $html += '<input type="hidden" name="question_num" value="'+question_num+'">';
                $html += '<div class="question_frontend_statement">';
                    $html += '<div class="question_title">';
                        $html += '<div class="question">';
                            $html += tinymce.get('truefalse_question_statement').getContent();
                        $html += '</div>';
                        $html += '<span class="display_none edit_question_link" style="text-decoration:underline;cursor:pointer;">';
                        $html += 'Edit';
                        $html += '</span>';
                    $html += '</div>';
                $html += '</div>';
                $html += '<div class="question_frontend_options">';
                    $html += '<div class="frontend_option">';
                        $html += '<div class="frontend-label">';
                            $html += '<input type="radio" name="option" value="1" id="option1" />';
                                $html += '<div class="option_val"><p>True</p></div>';
                                $html += '<div class="clearfix"></div>';
                        $html += '</div>';
                        $html += '<div id="response_option1" style="display:none;" class="frontend_response">';
                            $html += tinymce.get('truefalse_answer_selection_1').getContent();
                        $html += '</div>'
                    $html += '</div>';
                    ;
                    $html += '<div class="frontend_option">';
                        $html += '<div class="frontend-label">';
                            $html += '<input type="radio" name="option" value="2" id="option2" />';
                            $html += '<div class="option_val"><p>False</p></div>';
                            $html += '<div class="clearfix"></div>';
                        $html += '</div>';
                        $html += '<div id="response_option2" style="display:none;" class="frontend_response">';
                            $html += tinymce.get('truefalse_answer_selection_2').getContent();
                        $html += '</div>';
                    $html += '</div>';

                $html += '</div>';
                $html += '<div class="correct_option" style="display:none;">';
                    $html += correct;
                $html += '</div>';
                $html += '<div class="question_type" style="display:none;">';
                    $html += question_type;
                $html += '</div>';
                $html += '<input type="hidden" class="questionid" name="questionid" value="'+jQuery('.questionid_form').val()+'" />';
                $html += '<div class="question_frontend_submit_wrapper">';
                    $html += '<input type="submit" name="question_frontend_submit" value="Check Answer">';
                $html += '</div>';
            $html += '</form>';    
        $html += '</div>';
        $html += '<div>&nbsp;</div>';
        if(jQuery("#questions").length == 0) {
            jQuery('<input>').attr({
                type: 'hidden',
                id: 'questions',
                name: 'questions[]'
            }).appendTo('#create_resource_form');
        }
        var $q = [];
        var $a = {};
        var prev_questions_obj = [];
        if(jQuery('#questions').val() != ""){
            var prev_questions = jQuery('#questions').val();
            prev_questions_obj = JSON.parse(prev_questions);
            prev_questions_obj.forEach(function(item, index){
                $q.push(item);
            });
        }
//        $q.push(prev_questions_obj);
        $a.question_statement = jQuery('#question_statement').val();
        $a.answer_1 = jQuery('#answer_1').val();
        $a.answer_2 = jQuery('#answer_2').val();
        $a.answer_selection_1 = jQuery('#answer_selection_1').val();
        $a.answer_selection_2 = jQuery('#answer_selection_2').val();
        $a.correct_answer = jQuery('input[name=correct_answer]:checked').val();
        $a.questionid_form = jQuery('.questionid_form').val();

        $q.push($a);
        
        jQuery('#questions').val(JSON.stringify($q));
        editor.insertContent($html);
        
        attachEditButtonClickEvent();
        jQuery("#QuestionModal").modal("hide");
    });
}
function attachEditButtonClickEvent(){
    var iframe = jQuery('#elm1_ifr').contents();
    iframe.find(".edit_question_link").unbind().click(function(){
        var edit_question_link = jQuery(this);
        removeCurrectClassForm();
        var question_front_form= edit_question_link.parent().closest('.question_front_form');

        question_front_form.addClass('current');

        var data = {};
        var $old_contents = tinyMCE.activeEditor.getContent({format : 'raw'});
        var template = jQuery.parseHTML($old_contents);

        data.question_type = question_front_form.find('.question_type').html();
        
        if(data.question_type == 'mcq'){
            data.question_statement = question_front_form.find('.question_frontend_statement .question_title .question').html();
            data.option1 = question_front_form.find('#option1').next().html();
            data.option2 = question_front_form.find('#option2').next().html();
            data.option3 = question_front_form.find('#option3').next().html();
            data.option4 = question_front_form.find('#option4').next().html();
            data.option5 = question_front_form.find('#option5').next().html();
            data.response_option1 = question_front_form.find('#response_option1').html();
            data.response_option2 = question_front_form.find('#response_option2').html();
            data.response_option3 = question_front_form.find('#response_option3').html();
            data.response_option4 = question_front_form.find('#response_option4').html();
            data.response_option5 = question_front_form.find('#response_option5').html();
            data.correct_option = question_front_form.find('.correct_option').text();
            data.questionid = question_front_form.find('.questionid').val();
        } else if(data.question_type == 'true_false') {
            data.truefalse_question_statement = question_front_form.find('.question_frontend_statement .question_title .question').html();
            data.truefalse_answer_selection_1 = question_front_form.find('#response_option1').html();
            data.truefalse_answer_selection_2 = question_front_form.find('#response_option2').html();
            data.truefalse_correct_answer = question_front_form.find('.correct_option').text();
            data.questionid = question_front_form.find('.questionid').val();
        }
        
        
        
        
        if (typeof data.option1 == 'undefined'){
            data.option1 = '';
        }
        if (typeof data.option2 == 'undefined'){
            data.option2 = '';
        }
        if (typeof data.option3 == 'undefined'){
            data.option3 = '';
        }
        if (typeof data.option4 == 'undefined'){
            data.option4 = '';
        }
        if (typeof data.option5 == 'undefined'){
            data.option5 = '';
        }
        if (typeof data.response_option1 == 'undefined'){
            data.response_option1 = '';
        }
        if (typeof data.response_option2 == 'undefined'){
            data.response_option2 = '';
        }
        if (typeof data.response_option3 == 'undefined'){
            data.response_option3 = '';
        }
        if (typeof data.response_option4 == 'undefined'){
            data.response_option4 = '';
        }
        if (typeof data.response_option5 == 'undefined'){
            data.response_option5 = '';
        }
        if (typeof data.correct_option == 'undefined'){
            data.correct_option = '';
        }
        if (typeof data.questionid == 'undefined'){
            data.questionid = '';
        }
           openEditQuestionDialog(tinyMCE.activeEditor, data, $old_contents, question_front_form);
    });
}
function validateMCQQuestionEditor(question_form_this){
    var scrolled = 0;
    //Here goes the RegEx
    var patt = /^<p>(&nbsp;\s)+(&nbsp;)+<\/p>$/g;
    var scrollTo = null;
    
    var submit = true;
    
    var question_statement = tinyMCE.get('question_statement').getContent();
    var question_statement_iframe = jQuery('#question_statement').prev().contents().find('iframe');
    
    var answer_1 = tinyMCE.get('answer_1').getContent();
    var answer_1_iframe = jQuery('#answer_1').prev().contents().find('iframe');
    
    var answer_selection_1 = tinyMCE.get('answer_selection_1').getContent();
    var answer_selection_1_iframe = jQuery('#answer_selection_1').prev().contents().find('iframe');
    
    var answer_2 = tinyMCE.get('answer_2').getContent();
    var answer_2_iframe = jQuery('#answer_2').prev().contents().find('iframe');
    
    var answer_selection_2 = tinyMCE.get('answer_selection_2').getContent();
    var answer_selection_2_iframe = jQuery('#answer_selection_2').prev().contents().find('iframe');
    
    var answer_3 = tinyMCE.get('answer_3').getContent();
    var answer_3_iframe = jQuery('#answer_3').prev().contents().find('iframe');
    
    var answer_selection_3 = tinyMCE.get('answer_selection_3').getContent();
    var answer_selection_3_iframe = jQuery('#answer_selection_3').prev().contents().find('iframe');
    
    var answer_4 = tinyMCE.get('answer_4').getContent();
    var answer_4_iframe = jQuery('#answer_4').prev().contents().find('iframe');
    
    var answer_selection_4 = tinyMCE.get('answer_selection_4').getContent();
    var answer_selection_4_iframe = jQuery('#answer_selection_4').prev().contents().find('iframe');
    
    var answer_5 = tinyMCE.get('answer_5').getContent();
    var answer_5_iframe = jQuery('#answer_5').prev().contents().find('iframe');
    
    var answer_selection_5 = tinyMCE.get('answer_selection_5').getContent();
    var answer_selection_5_iframe = jQuery('#answer_selection_5').prev().contents().find('iframe');
    
    
    
    

    if (question_statement == '' || patt.test(question_statement)) {
        question_statement_iframe.addClass('error');
        
        if(scrolled == 0){
            var scrollelement = 'question_statement';
            scrollToElement(scrollelement);
            scrolled = 1;
        }
        
        submit = false;
    }
    else {
        question_statement_iframe.removeClass('error');
    }
    
    /* Validating answer 1 */
    if (answer_1 == '' || patt.test(answer_1)) {
        answer_1_iframe.addClass('error');
        if(scrolled == 0){
            var scrollelement = 'answer_1';
            scrollToElement(scrollelement);
            scrolled = 1;
        }
        submit = false;
    }
    else {
        answer_1_iframe.removeClass('error');
    }
    
    if (answer_selection_1 == '' || patt.test(answer_selection_1)) {
        answer_selection_1_iframe.addClass('error');
        if(scrolled == 0){
            var scrollelement = 'answer_selection_1';
            scrollToElement(scrollelement);
            scrolled = 1;
        }
        submit = false;
    }
    else {
        answer_selection_1_iframe.removeClass('error');
    }
    
    /* Validating answer 2 */
    if (answer_2 == '' || patt.test(answer_2)) {
        answer_2_iframe.addClass('error');
        if(scrolled == 0){
            var scrollelement = 'answer_2';
            scrollToElement(scrollelement);
            scrolled = 1;
        }
        submit = false;
    }
    else {
        answer_2_iframe.removeClass('error');
    }
    
    if (answer_selection_2 == '' || patt.test(answer_selection_2)) {
        answer_selection_2_iframe.addClass('error');
        if(scrolled == 0){
            var scrollelement = 'answer_selection_2';
            scrollToElement(scrollelement);
            scrolled = 1;
        }
        submit = false;
    }
    else {
        answer_selection_2_iframe.removeClass('error');
    }
    
    /*   correct answer validation */
    if(!jQuery('[name=correct_answer]').is(':checked')){
        jQuery('#answer_model_correct_answer_1').parent().addClass('error');
        if(scrolled == 0){
            var scrollelement = 'correct_answer';
            scrollToElement(scrollelement);
            scrolled = 1;
        }
        submit = false;
    } else {
        jQuery('#answer_model_correct_answer_1').parent().removeClass('error');
    }
    
    
    
    return submit;
}

function validateTrueFalseQuestionEditor(question_form_this){
    var scrolled = 0;
    //Here goes the RegEx
    var patt = /^<p>(&nbsp;\s)+(&nbsp;)+<\/p>$/g;
    var scrollTo = null;
    
    var submit = true;
    
    var question_statement = tinyMCE.get('truefalse_question_statement').getContent();
    var question_statement_iframe = jQuery('#truefalse_question_statement').prev().contents().find('iframe');
    
    var answer_selection_1 = tinyMCE.get('truefalse_answer_selection_1').getContent();
    var answer_selection_1_iframe = jQuery('#truefalse_answer_selection_1').prev().contents().find('iframe');
    
    
    
    var answer_selection_2 = tinyMCE.get('truefalse_answer_selection_2').getContent();
    var answer_selection_2_iframe = jQuery('#truefalse_answer_selection_2').prev().contents().find('iframe');
    
    
    
    

    if (question_statement == '' || patt.test(question_statement)) {
        question_statement_iframe.addClass('error');
        
        if(scrolled == 0){
            var scrollelement = 'truefalse_question_statement';
            scrollToElement(scrollelement);
            scrolled = 1;
        }
        
        submit = false;
    }
    else {
        question_statement_iframe.removeClass('error');
    }
    
    
    
    if (answer_selection_1 == '' || patt.test(answer_selection_1)) {
        answer_selection_1_iframe.addClass('error');
        if(scrolled == 0){
            var scrollelement = 'truefalse_answer_selection_1';
            scrollToElement(scrollelement);
            scrolled = 1;
        }
        submit = false;
    }
    else {
        answer_selection_1_iframe.removeClass('error');
    }
    
    
    
    if (answer_selection_2 == '' || patt.test(answer_selection_2)) {
        answer_selection_2_iframe.addClass('error');
        if(scrolled == 0){
            var scrollelement = 'truefalse_answer_selection_2';
            scrollToElement(scrollelement);
            scrolled = 1;
        }
        submit = false;
    }
    else {
        answer_selection_2_iframe.removeClass('error');
    }
    
    /*   correct answer validation */
    if(!question_form_this.find('[name=truefalse_correct_answer]').is(':checked')){
        
        jQuery('#truefalse_correct_answer_wrapper').addClass('error');
        if(scrolled == 0){
            var scrollelement = 'truefalse_correct_answer';
            scrollToElement(scrollelement);
            scrolled = 1;
        }
        
        submit = false;
    } else {
        jQuery('#truefalse_correct_answer_wrapper').removeClass('error');
    }
    
    
    
    return submit;
}

var entityMap = {
  '&': '&amp;',
  '<': '&lt;',
  '>': '&gt;',
  '"': '&quot;',
  "'": '&#39;',
  '/': '&#x2F;',
  '`': '&#x60;',
  '=': '&#x3D;'
};
function escapeHtml (string) {
  return String(string).replace(/[&<>"'`=\/]/g, function (s) {
    return entityMap[s];
  });
}

function scrollToElement(scrollElement){
    // get the div position
//    alert(scrollElement);
    var position = jQuery('#' + scrollElement + '_wrapper').position();
    // scroll modal to position top
//    jQuery("#QuestionModal").scrollTop(position.top);
    jQuery("#QuestionModal").stop().animate({scrollTop:position.top}, 500, 'swing', function() { 
     });

}



function questionsModal(){
    $html = `
<div class="modal fade" id="QuestionModal" tabindex="-1" role="dialog" aria-labelledby="QuestionModalLabel"  data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Insert Question</h4>
            </div>
            <div class="modal-body">
                <div class="container">
                    <ul class="nav nav-tabs">
                        <li class="active"><a data-toggle="tab" href="#mcqs">MCQs</a></li>
                        <li><a data-toggle="tab" href="#true_false">True / False</a></li>
                    </ul>

                    <div class="tab-content">
                        <div id="mcqs" class="tab-pane fade in active">
                            <form  id="mcq_question_form" class="mcq_question_form">
                                <div class="mcqs_wrapper">
                                    <div class="row" id="question_statement_wrapper">
                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <label for="question_statement">Question:</label>
                                                <textarea id = "question_statement" class="question_model" name = "question_statement" ></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-5" id="answer_1_wrapper">
                                            <div class="form-group">
                                                <label for="answer_1">Answer 1:</label>
                                                <textarea id = "answer_1" class="question_model" name = "answer_1" ></textarea>
                                            </div>
                                        </div>
                                        <div class="col-md-5" id="answer_selection_1_wrapper">
                                            <div class="form-group">
                                                <label for="answer_selection_1">Response 1:</label>
                                                <textarea id = "answer_selection_1" class="question_model" name = "answer_selection_1" ></textarea>
                                            </div>
                                        </div>
                                        <div class="col-md-2" id="correct_answer_wrapper">
                                            <div class="form-group">
                                                <input type="radio" name="correct_answer" id="answer_model_correct_answer_1" value="1">
                                                <label for="answer_model_correct_answer_1">Correct</label>
                                                <span class="question-tooltip tooltip fa fa-question-circle" data-hasqtip="9">&nbsp;</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-5" id="answer_2_wrapper">
                                            <div class="form-group">
                                                <label for="answer_2">Answer 2:</label>
                                                <textarea id = "answer_2" class="question_model" name = "answer_2" ></textarea>
                                            </div>
                                        </div>
                                        <div class="col-md-5" id="answer_selection_2_wrapper">
                                            <div class="form-group">
                                                <label for="answer_selection_2">Response 2:</label>
                                                <textarea id = "answer_selection_2" class="question_model" name = "answer_selection_2" ></textarea>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <input type="radio" name="correct_answer" id="answer_model_correct_answer_2" value="2">
                                                <label for="answer_model_correct_answer_2">Correct</label>
                                                <span class="question-tooltip tooltip fa fa-question-circle" data-hasqtip="9">&nbsp;</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-5">
                                            <div class="form-group">
                                                <label for="answer_3">Answer 3:</label>
                                                <textarea id = "answer_3" class="question_model" name = "answer_3" ></textarea>
                                            </div>
                                        </div>
                                        <div class="col-md-5">
                                            <div class="form-group">
                                                <label for="answer_selection_3">Response 3:</label>
                                                <textarea id = "answer_selection_3" class="question_model" name = "answer_selection_3" ></textarea>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <input type="radio" name="correct_answer" id="answer_model_correct_answer_3" value="3">
                                                <label for="answer_model_correct_answer_3">Correct</label>
                                                <span class="question-tooltip tooltip fa fa-question-circle" data-hasqtip="9">&nbsp;</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-5">
                                            <div class="form-group">
                                                <label for="answer_4">Answer 4:</label>
                                                <textarea id = "answer_4" class="question_model" name = "answer_4" ></textarea>
                                            </div>
                                        </div>
                                        <div class="col-md-5">
                                            <div class="form-group">
                                                <label for="answer_selection_4">Response 4:</label>
                                                <textarea id = "answer_selection_4" class="question_model" name = "answer_selection_4" ></textarea>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <input type="radio" name="correct_answer" id="answer_model_correct_answer_4" value="4">
                                                <label for="answer_model_correct_answer_4">Correct</label>
                                                <span class="question-tooltip tooltip fa fa-question-circle" data-hasqtip="9">&nbsp;</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-5">
                                            <div class="form-group">
                                                <label for="answer_5">Answer 5:</label>
                                                <textarea id = "answer_5" class="question_model" name = "answer_5" ></textarea>
                                            </div>
                                        </div>
                                        <div class="col-md-5">
                                            <div class="form-group">
                                                <label for="answer_selection_5">Response 5:</label>
                                                <textarea id = "answer_selection_5" class="question_model" name = "answer_selection_5" ></textarea>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <input type="radio" name="correct_answer" id="answer_model_correct_answer_5" value="5">
                                                <label for="answer_model_correct_answer_5">Correct</label>
                                                <span class="question-tooltip tooltip fa fa-question-circle" data-hasqtip="9">&nbsp;</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                            <input type="submit" name="submit" class="btn btn-primary" value="Save changes" />
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" name="question_type" value="mcq" />
                            </form>
                        </div>
                        <div id="true_false" class="tab-pane fade">
                            <form  id="truefalse_question_form" class="truefalse_question_form">
                                <div class="true_false_wrapper">
                                    <div class="row" id="truefalse_question_statement_wrapper">
                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <label for="truefalse_question_statement">Question:</label>
                                                <textarea id = "truefalse_question_statement" class="question_model" name = "truefalse_question_statement" ></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row" id="truefalse_answer_selection_1_wrapper">
                                        <div class="col-md-5">
                                            <div class="form-group">
                                                <label for="truefalse_answer_1">Answer 1:</label>
                                                <strong>True</strong>
                                                <input type="hidden" name="truefalse_answer_1" value="True" />
                                            </div>
                                        </div>
                                        <div class="col-md-5">
                                            <div class="form-group">
                                                <label for="truefalse_answer_selection_1">Response 1:</label>
                                                <textarea id = "truefalse_answer_selection_1" class="question_model" name = "truefalse_answer_selection_1" ></textarea>
                                            </div>
                                        </div>
                                        <div class="col-md-2" id="truefalse_correct_answer_wrapper">
                                            <div class="form-group">
                                                <label>
                                                <input type="radio" name="truefalse_correct_answer" value="1">
                                                Correct</label>
                                                <span class="question-tooltip tooltip fa fa-question-circle" data-hasqtip="9">&nbsp;</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row" id="truefalse_answer_selection_2_wrapper">
                                        <div class="col-md-5">
                                            <div class="form-group">
                                                <label for="answer_2">Answer 2:</label>
                                                <strong>False</strong>
                                                <!--<textarea id = "answer_2" class="question_model" name = "answer_2" ></textarea>-->
                                                <input type="hidden" name="truefalse_answer_2" value="False" />
                                            </div>
                                        </div>
                                        <div class="col-md-5">
                                            <div class="form-group">
                                                <label for="truefalse_answer_selection_2">Response 2:</label>
                                                <textarea id = "truefalse_answer_selection_2" class="question_model" name = "truefalse_answer_selection_2" ></textarea>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label>
                                                <input type="radio" name="truefalse_correct_answer" value="2">
                                                Correct</label>
                                                <span class="question-tooltip tooltip fa fa-question-circle" data-hasqtip="9">&nbsp;</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                            <input type="submit" name="submit" class="btn btn-primary" value="Save changes" />
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" name="question_type" value="true_false" />
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
`;
    return $html;
}

function removeCurrectClassForm(){
    var iframe = jQuery('#elm1_ifr').contents();
    iframe.find(".question_front_form").removeClass('current');
}